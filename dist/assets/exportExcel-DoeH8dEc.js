import{u as d,C as F,w as B,F as _,D as I,a as M}from"./index-BmMAdtDe.js";async function $(l,h=null){try{const r=l&&l.length>0;let m,s;if(h)m=h.startDate,s=h.endDate;else if(r){const e=[...l].sort((o,c)=>new Date(o.date)-new Date(c.date));m=e[0].date,s=e[e.length-1].date}else{const e=new Date,o=new Date(e);o.setDate(o.getDate()-1),s=o.toISOString().split("T")[0];const c=new Date(o);c.setDate(c.getDate()-27),m=c.toISOString().split("T")[0]}const i=`治疗记录_${m}_至_${s}.xlsx`,p=[["星期"],["日期"],["血压"],["体重(不带水)"],["加热袋"],["补充袋"],["治疗方式"],["总治疗量"],["治疗时间"],["单次注入量"],["末袋注入量"],["循环次数"],["0周期超流量"],["机器总超滤量"],["日间手工注入量"],["日间注入浓度"],["日间超滤量"],["机器+手工总超滤量"],["饮水量"]],w=d.book_new(),k=d.aoa_to_sheet(p);d.book_append_sheet(w,k,"Sheet1");const S=w.Sheets.Sheet1;let t=d.sheet_to_json(S,{header:1});const g=1,b=0,n={bloodPressure:2,weight:3,heatingBag:4,supplementBag:5,treatmentMethod:6,totalTreatmentVolume:7,treatmentTime:8,singleInjectionVolume:9,lastBagInjectionVolume:10,cycleCount:11,zeroCircleFlow:12,machineTotalFlow:13,dayManualInjection:14,dayInjectionConcentration:15,dayUltrafiltration:16,machinePlusManualFlow:17,waterIntake:18};for(let e=0;e<=n.waterIntake;e++)t[e]||(t[e]=[]);for(const e of l){const o=e.date,c=["日","一","二","三","四","五","六"],j=e.weekday||c[new Date(o).getDay()];let a=-1;if(t.length>g)for(let u=1;u<t[g].length;u++){const D=t[g][u],T=String(D).trim(),x=String(o).trim();if(T===x){a=u;break}}a===-1&&(a=t[0]?t[0].length:1),t.forEach((u,D)=>{for(;u.length<=a;)u.push("")}),t[g][a]=o,t[b][a]=j,t[n.bloodPressure][a]=e.bloodPressure,t[n.weight][a]=e.weight,t[n.heatingBag][a]=e.heatingBag||"2.5",t[n.supplementBag][a]=e.supplementBag||"2.5",t[n.treatmentMethod][a]=e.treatmentMethod||"IPD",t[n.totalTreatmentVolume][a]=e.totalTreatmentVolume||"8000",t[n.treatmentTime][a]=e.treatmentTime||"10",t[n.singleInjectionVolume][a]=e.singleInjectionVolume||"2000",t[n.lastBagInjectionVolume][a]=e.lastBagInjectionVolume||"0",t[n.cycleCount][a]=e.cycleCount||"4",t[n.zeroCircleFlow][a]=e.zeroCircleFlow,t[n.machineTotalFlow][a]=e.machineTotalFlow,t[n.dayManualInjection][a]=e.dayManualInjection||"2000",t[n.dayInjectionConcentration][a]=e.dayInjectionConcentration||"艾烤糊精",t[n.dayUltrafiltration][a]=e.dayUltrafiltration,t[n.machinePlusManualFlow][a]=e.machinePlusManualFlow,t[n.waterIntake][a]=e.waterIntake}const C=d.aoa_to_sheet(t);w.Sheets.Sheet1=C;const y=F.isNativePlatform();let f="";if(y){const e=B(w,{bookType:"xlsx",type:"array"}),o=V(e);await _.writeFile({path:i,data:o,directory:I.Documents,recursive:!0}),console.log(`文件已保存到移动端 Documents 目录: ${i}`),f=`${I.Documents}/${i}`}else M(w,i);return{success:!0,message:y?`数据已成功导出到移动端 Documents 目录: ${i}`:`数据已成功导出到Excel文件: ${i}`,fileName:i,savePath:y?f:"",recordCount:l?l.length:0}}catch(r){throw console.error("导出Excel时出错:",r),r}}function V(l){let h="";const r=new Uint8Array(l),m=r.byteLength;for(let s=0;s<m;s++)h+=String.fromCharCode(r[s]);return btoa(h)}export{$ as exportMultipleRecordsToExcel};
